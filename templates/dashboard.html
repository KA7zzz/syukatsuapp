{% extends "base.html" %}

{% block title %}ダッシュボード - 就活管理アプリ{% endblock %}

{% block content %}
    <h2>ダッシュボード</h2>
    <p>ようこそ、{{ current_user.username }}さん！</p>

    <hr>
    
    <div class="section-box">
        <h3>スケジュールカレンダー</h3>
        <div id="calendar-wrapper">
            <div id='calendar'></div>
        </div>
    </div>

    <hr>

    <div class="section-box">
        <h3>応募企業一覧</h3>
        {% if companies %}
            <div class="responsive-list">
                {% for company in companies %}
                <a href="{{ url_for('company_detail', company_id=company.id) }}" class="list-item-link">
                    <div class="list-item">
                        <div class="item-header"><strong>{{ company.name }}</strong></div>
                        <div class="item-body">
                            <span><strong>業界:</strong> {{ company.industry or '未設定' }}</span>
                            <span><strong>選考段階:</strong> {{ company.selection_stage or '未設定' }}</span>
                        </div>
                    </div>
                </a>
                {% endfor %}
            </div>
        {% else %}
            <p>まだ応募企業が登録されていません。</p>
        {% endif %}
    </div>

    <hr>

    <div class="section-box">
        </div>
    
    <script>
        // ★変更点: カレンダー初期化スクリプトを元に戻す
        document.addEventListener('DOMContentLoaded', function() {
          var calendarEl = document.getElementById('calendar');
          if (calendarEl) {
              var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                locale: 'ja',
                headerToolbar: {
                  left: 'prev,next today',
                  center: 'title',
                  right: 'dayGridMonth,timeGridWeek,listWeek'
                },
                events: JSON.parse('{{ calendar_events|safe }}'),
                eventClick: function(info) {
                  if (info.event.url && info.event.url !== '#') {
                      window.location.href = info.event.url;
                      info.jsEvent.preventDefault(); 
                  }
                }
              });
              calendar.render();
          }
        });
    </script>
    
    <style>
        .section-box { padding: 20px; margin-bottom: 25px; border-radius: 8px; background-color: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        h3 { margin-top: 0; border-bottom: 2px solid #007bff; padding-bottom: 10px; margin-bottom: 15px; }

        /* 企業一覧のスタイル */
        .list-item-link { color: inherit; text-decoration: none; }
        .list-item { border: 1px solid #ddd; border-radius: 8px; margin-bottom: 10px; padding: 15px; transition: background-color 0.2s; }
        .list-item:hover { background-color: #f8f9fa; }
        .item-header { font-size: 1.2em; margin-bottom: 10px; }
        .item-body span { display: block; margin-bottom: 5px; color: #555; }

        /* --- メディアクエリ --- */
        @media (max-width: 768px) {
            body { margin: 10px; }
            .section-box { padding: 15px; }
            h2 { font-size: 1.5em; }
            
            /* ★変更点: カレンダーのツールバーのスタイルを調整 */
            .fc .fc-toolbar.fc-header-toolbar {
                display: flex;
                flex-direction: column;
                align-items: center;
                font-size: 0.9em;
            }
            .fc-toolbar-chunk { margin-bottom: 5px; }
        }
    </style>
{% endblock %}